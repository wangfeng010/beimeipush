# å¿«é€Ÿå‚è€ƒæŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è®­ç»ƒæ¨¡å‹
```bash
python src/train_MLP.py
```

### ä¸»è¦é…ç½®æ–‡ä»¶
- `config/data.yml` - æ•°æ®æºé…ç½®
- `config/train.yml` - è®­ç»ƒå‚æ•°é…ç½®  
- `config/feat.yml` - ç‰¹å¾å·¥ç¨‹é…ç½®

## ğŸ“Š æ•°æ®æµç¨‹

```
CSVæ•°æ® â†’ ç‰¹å¾é¢„å¤„ç†(UniProcess) â†’ MLPæ¨¡å‹è®­ç»ƒ â†’ æ€§èƒ½è¯„ä¼°
```

### å…³é”®æ­¥éª¤
1. **æ•°æ®åŠ è½½**: è¯»å–CSVï¼Œåˆ†ç¦»ç‰¹å¾å’Œæ ‡ç­¾
2. **ç‰¹å¾é¢„å¤„ç†**: åº”ç”¨å“ˆå¸ŒåŒ–ã€å¡«å……ç­‰æ“ä½œ
3. **æ¨¡å‹è®­ç»ƒ**: TensorFlow Embedding + MLPç½‘ç»œ
4. **ç»“æœè¯„ä¼°**: AUCæŒ‡æ ‡ + ç‰¹å¾é‡è¦æ€§åˆ†æ

## ğŸ”§ å…³é”®æ¨¡å—

### ç‰¹å¾é¢„å¤„ç† (`src/data/feature_preprocessor.py`)
```python
from src.data.feature_preprocessor import apply_feature_preprocessing

# åº”ç”¨ç‰¹å¾é¢„å¤„ç†
processed_dataset = apply_feature_preprocessing(
    dataset, 
    feat_config_path="config/feat.yml"
)
```

### é…ç½®åŠ è½½ (`src/utils/config_loader.py`)
```python
from src.utils.config_loader import load_feature_config

# åŠ è½½ç‰¹å¾é…ç½®ï¼ˆæ”¯æŒæ’é™¤æŸäº›ç‰¹å¾ï¼‰
features = load_feature_config(
    "config/feat.yml",
    exclude_features=["feature_to_exclude"]
)
```

### æ“ä½œå‡½æ•° (`src/preprocess/operations.py`)
- `fillna` - ç¼ºå¤±å€¼å¡«å……
- `str_hash` - å­—ç¬¦ä¸²å“ˆå¸ŒåŒ–
- `list_hash` - åˆ—è¡¨å“ˆå¸ŒåŒ–
- `padding` - åºåˆ—å¡«å……
- `json_object_to_list` - JSONè§£æ
- `to_hour` / `to_weekday` - æ—¶é—´ç‰¹å¾æå–

## ğŸ“‹ ç‰¹å¾é…ç½®ç¤ºä¾‹

```yaml
pipelines:
  - feat_name: country_hash
    feat_type: sparse
    vocabulary_size: 200
    embedding_dim: 8
    operations:
      - col_in: country
        col_out: country
        func_name: fillna
        func_parameters:
          na_value: "null"
      - col_in: country
        col_out: country_hash
        func_name: str_hash
        func_parameters:
          vocabulary_size: 200
```

## ğŸ¯ æ”¯æŒçš„ç‰¹å¾ç±»å‹

| ç‰¹å¾ç±»å‹ | æè¿° | ç¤ºä¾‹ |
|----------|------|------|
| `sparse` | å•å€¼åˆ†ç±»ç‰¹å¾ | country_hash: 156 |
| `varlen_sparse` | å˜é•¿åˆ—è¡¨ç‰¹å¾ | watchlists: [456, 789, 0] |
| `dense` | æ•°å€¼ç‰¹å¾ | title_length: 42.5 |

## âš ï¸ å¸¸è§é—®é¢˜

### 1. ç‰¹å¾æ•°é‡ä¸åŒ¹é…
**é—®é¢˜**: `ValueError: æ²¡æœ‰å¯ç”¨çš„ç‰¹å¾è¾“å‡º`
**è§£å†³**: æ£€æŸ¥feat.ymlé…ç½®ä¸å®é™…æ•°æ®åˆ—åæ˜¯å¦åŒ¹é…

### 2. log_typeå¤„ç†
**é‡è¦**: log_typeæ˜¯æ ‡ç­¾ï¼Œä¸æ˜¯ç‰¹å¾
- åœ¨æ•°æ®åŠ è½½æ—¶è¢«è‡ªåŠ¨æå–ä¸ºæ ‡ç­¾
- ä¸åº”å‡ºç°åœ¨feat.ymlç‰¹å¾é…ç½®ä¸­

### 3. TensorFlowç‰ˆæœ¬å…¼å®¹
**å»ºè®®**: ä½¿ç”¨TensorFlow 2.xç‰ˆæœ¬
```bash
pip install tensorflow>=2.8.0
```

## ğŸ“ˆ æ€§èƒ½åŸºå‡†

### å½“å‰æœ€ä½³ç»“æœ
- **è®­ç»ƒAUC**: 0.8467
- **éªŒè¯AUC**: 0.8558
- **ç‰¹å¾æ•°é‡**: 12ä¸ª
- **æ¨¡å‹å‚æ•°**: ~491K

### é‡è¦ç‰¹å¾æ’åº
1. user_propernoun_hash (18.8%)
2. country_hash (4.5%)
3. user_watch_stk_code_hash (1.3%)

## ğŸ” è°ƒè¯•å·¥å…·

### éªŒè¯æ•°æ®é¢„å¤„ç†
```python
from src.data.feature_preprocessor import preprocess_features

test_data = {'country': ['US', 'CN'], 'watchlists': ['AAPL', 'TSLA']}
result = preprocess_features(test_data)
print(result)
```

### æ£€æŸ¥ç‰¹å¾é…ç½®
```python
from src.utils.config_loader import load_feature_config

configs = load_feature_config("config/feat.yml")
print(f"é…ç½®çš„ç‰¹å¾æ•°é‡: {len(configs)}")
for config in configs:
    print(f"- {config['feat_name']}: {config['feat_type']}")
```

### æ•°æ®é›†éªŒè¯
```bash
python -c "from src.data.dataset_utils import build_dataset; print('æ•°æ®é›†æ„å»ºæ­£å¸¸')"
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ config/              # é…ç½®æ–‡ä»¶
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ data/           # æ•°æ®å¤„ç†
â”‚   â”œâ”€â”€ models/         # æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ preprocess/     # é¢„å¤„ç†æ“ä½œ
â”‚   â””â”€â”€ utils/          # å·¥å…·å‡½æ•°
â”œâ”€â”€ doc/                # æ–‡æ¡£
â””â”€â”€ data/               # è®­ç»ƒæ•°æ®
```

## ğŸ’¡ å¼€å‘æç¤º

### æ·»åŠ æ–°çš„ç‰¹å¾æ“ä½œ
1. åœ¨ `src/preprocess/operations.py` ä¸­å®šä¹‰å‡½æ•°
2. å°†å‡½æ•°æ·»åŠ åˆ° `OP_HUB` å­—å…¸
3. åœ¨ `config/feat.yml` ä¸­é…ç½®ä½¿ç”¨

### è°ƒæ•´æ¨¡å‹ç»“æ„
- ä¿®æ”¹ `src/models/deep/mlp.py` ä¸­çš„ç½‘ç»œå±‚å®šä¹‰
- è°ƒæ•´ `config/train.yml` ä¸­çš„è¶…å‚æ•°

### ç‰¹å¾å®éªŒ
- ä½¿ç”¨ `exclude_features` å‚æ•°æ’é™¤ç‰¹å¾
- æ¯”è¾ƒä¸åŒç‰¹å¾ç»„åˆçš„æ€§èƒ½

---

å¦‚éœ€æ›´è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è€ƒ `é¡¹ç›®æŠ€æœ¯æ–‡æ¡£.md`ã€‚ 
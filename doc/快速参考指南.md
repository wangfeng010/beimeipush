# 快速参考指南

## 🚀 快速开始

### 训练模型
```bash
python src/train_MLP.py
```

### 主要配置文件
- `config/data.yml` - 数据源配置
- `config/train.yml` - 训练参数配置  
- `config/feat.yml` - 特征工程配置

## 📊 数据流程

```
CSV数据 → 特征预处理(UniProcess) → MLP模型训练 → 性能评估
```

### 关键步骤
1. **数据加载**: 读取CSV，分离特征和标签
2. **特征预处理**: 应用哈希化、填充等操作
3. **模型训练**: TensorFlow Embedding + MLP网络
4. **结果评估**: AUC指标 + 特征重要性分析

## 🔧 关键模块

### 特征预处理 (`src/data/feature_preprocessor.py`)
```python
from src.data.feature_preprocessor import apply_feature_preprocessing

# 应用特征预处理
processed_dataset = apply_feature_preprocessing(
    dataset, 
    feat_config_path="config/feat.yml"
)
```

### 配置加载 (`src/utils/config_loader.py`)
```python
from src.utils.config_loader import load_feature_config

# 加载特征配置（支持排除某些特征）
features = load_feature_config(
    "config/feat.yml",
    exclude_features=["feature_to_exclude"]
)
```

### 操作函数 (`src/preprocess/operations.py`)
- `fillna` - 缺失值填充
- `str_hash` - 字符串哈希化
- `list_hash` - 列表哈希化
- `padding` - 序列填充
- `json_object_to_list` - JSON解析
- `to_hour` / `to_weekday` - 时间特征提取

## 📋 特征配置示例

```yaml
pipelines:
  - feat_name: country_hash
    feat_type: sparse
    vocabulary_size: 200
    embedding_dim: 8
    operations:
      - col_in: country
        col_out: country
        func_name: fillna
        func_parameters:
          na_value: "null"
      - col_in: country
        col_out: country_hash
        func_name: str_hash
        func_parameters:
          vocabulary_size: 200
```

## 🎯 支持的特征类型

| 特征类型 | 描述 | 示例 |
|----------|------|------|
| `sparse` | 单值分类特征 | country_hash: 156 |
| `varlen_sparse` | 变长列表特征 | watchlists: [456, 789, 0] |
| `dense` | 数值特征 | title_length: 42.5 |

## ⚠️ 常见问题

### 1. 特征数量不匹配
**问题**: `ValueError: 没有可用的特征输出`
**解决**: 检查feat.yml配置与实际数据列名是否匹配

### 2. log_type处理
**重要**: log_type是标签，不是特征
- 在数据加载时被自动提取为标签
- 不应出现在feat.yml特征配置中

### 3. TensorFlow版本兼容
**建议**: 使用TensorFlow 2.x版本
```bash
pip install tensorflow>=2.8.0
```

## 📈 性能基准

### 当前最佳结果
- **训练AUC**: 0.8467
- **验证AUC**: 0.8558
- **特征数量**: 12个
- **模型参数**: ~491K

### 重要特征排序
1. user_propernoun_hash (18.8%)
2. country_hash (4.5%)
3. user_watch_stk_code_hash (1.3%)

## 🔍 调试工具

### 验证数据预处理
```python
from src.data.feature_preprocessor import preprocess_features

test_data = {'country': ['US', 'CN'], 'watchlists': ['AAPL', 'TSLA']}
result = preprocess_features(test_data)
print(result)
```

### 检查特征配置
```python
from src.utils.config_loader import load_feature_config

configs = load_feature_config("config/feat.yml")
print(f"配置的特征数量: {len(configs)}")
for config in configs:
    print(f"- {config['feat_name']}: {config['feat_type']}")
```

### 数据集验证
```bash
python -c "from src.data.dataset_utils import build_dataset; print('数据集构建正常')"
```

## 📁 项目结构

```
├── config/              # 配置文件
├── src/
│   ├── data/           # 数据处理
│   ├── models/         # 模型定义
│   ├── preprocess/     # 预处理操作
│   └── utils/          # 工具函数
├── doc/                # 文档
└── data/               # 训练数据
```

## 💡 开发提示

### 添加新的特征操作
1. 在 `src/preprocess/operations.py` 中定义函数
2. 将函数添加到 `OP_HUB` 字典
3. 在 `config/feat.yml` 中配置使用

### 调整模型结构
- 修改 `src/models/deep/mlp.py` 中的网络层定义
- 调整 `config/train.yml` 中的超参数

### 特征实验
- 使用 `exclude_features` 参数排除特征
- 比较不同特征组合的性能

---

如需更详细信息，请参考 `项目技术文档.md`。 